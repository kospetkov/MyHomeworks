<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="assets/css/reset.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="icon" type="image/png" href="assets/img/kotel.png">
    <title>КОТЁЛ PLUS</title>
</head>
<body>

<div class="content">
    <div class="main-content">

        <div class="top__section">
            <div class="top__left-column">
                <div class="main-logo__wrapper">
                    <img src="assets/img/logo-black.png" alt="logo" class="logo">
                </div>
                <div class="contact__wrapper">
                    <img src="assets/img/phone-receiver.png" alt="icon phone" class="phone">
                    <div class="phone-number__wrapper">
                        <span class="phone-number">(067) 887-84-68</span>
                        <span class="phone-number">(066) 805-88-46</span>
                    </div>
                </div>
            </div>

            <div class="slider">
                <div class="slider__wrapper">
                    <div class="slider-img__wrapper">
                        <img src="assets/img/kotel-otoplenija-na-zhidkom-toplive-1.png" alt="photo" class="slider-img">
                    </div>
                    <div class="slider-img__wrapper">
                        <img src="assets/img/2_UMpqja3.png" alt="photo" class="slider-img">
                    </div>
                    <div class="slider-img__wrapper">
                        <img src="assets/img/tverdotoplivnyjj-kotel-otoplenie-2.png" alt="photo" class="slider-img">
                    </div>
                    <div class="slider-img__wrapper">
                        <img src="assets/img/kotel-otoplenija-na-zhidkom-toplive-1.png" alt="photo" class="slider-img">
                    </div>
                    <div class="slider-img__wrapper">
                        <img src="assets/img/2_UMpqja3.png" alt="photo" class="slider-img">
                    </div>
                    <div class="slider-img__wrapper">
                        <img src="assets/img/tverdotoplivnyjj-kotel-otoplenie-2.png" alt="photo" class="slider-img">
                    </div>
                </div>
            </div>
        </div>

        <div class="bottom__section">
            <div class="sidebar" id="sidebar">
                <div class="sidebar__wrapper">
                    <div class="category__wrapper">
                        <div class="category__item">
                            <img src="assets/img/kotel.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                котлы
                            </span>
                            <div class="subcategory">
                                <div class="subcategory-item__wrapper">
                                    <div class="subcategory__item">
                                        <a href="#" class="subcategory-item__title">твердотопливные</a>
                                        <a href="#" class="subcategory-item__name">с автоматической подачей топлива</a>
                                        <a href="#" class="subcategory-item__name">ручная загрузка</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <a href="#" class="subcategory-item__title">газовые</a>
                                        <a href="#" class="subcategory-item__name">настенные</a>
                                        <a href="#" class="subcategory-item__name">напольные</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <a href="#" class="subcategory-item__title">электрические</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="category__item">
                            <img src="assets/img/kotel.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                теплоаккумуляторы
                            </span>
                            <div class="subcategory">
                                <div class="subcategory-item__wrapper">
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="category__item">
                            <img src="assets/img/kotel.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                дымоходы
                            </span>
                            <div class="subcategory">
                                <div class="subcategory-item__wrapper">
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="category__item">
                            <img src="assets/img/kotel.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                доставка
                            </span>
                            <div class="subcategory">
                                <div class="subcategory-item__wrapper">
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="category__item">
                            <img src="assets/img/kotel.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                контакты
                            </span>
                            <div class="subcategory">
                                <div class="subcategory-item__wrapper">
                                    <div class="subcategory__item">
                                        <span class="subcategory-item__title">SUBCATEGORY</span>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                        <a href="#" class="subcategory-item__name">KOTEL mr 568/ht674</a>
                                        <a href="#" class="subcategory-item__name">KOTEL "jhmfhv" dd-w/3456sf</a>
                                        <a href="#" class="subcategory-item__name">KOTEL djzn.b//;krt wq</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="bottom__inform">
                        <div class="inform__item">
                            <img src="assets/img/placeholder.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                Украина, г.Кропивницкий, ул.Вячеслава Черновола 28.
                            </span>
                        </div>
                        <div class="inform__item">
                            <img src="assets/img/mail.png" alt="icon" class="category__icon">
                            <span class="category__name">
                                kotelplus.kr@gmail.com
                            </span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bottom__right-column" id="right_column">
                <div class="bottom__content">
                    Много текста про практику работы с PHPUnit/DbUnit
                    PHP
                    Доброго времени суток, друзья!
                    Хочу поделиться опытом по борьбе с PHPUnit/DbUnit в связке с MySQL. Далее небольшая предыстория.

                    Краткая предыстория

                    В процессе написания одного веб-приложения возникла необходимость тестировать код на PHP, интенсивно взаимодействующий с БД MySQL. В проекте в качестве фреймворка модульного тестирования использовался порт xUnit — PHPUnit. В результате было принято решение писать тесты для модулей, непосредственно взаимодействующих с базой, подцепив плагин PHPUnit/DbUnit. Дальше я расскажу о тех трудностях, которые возникли при написании тестов и о том, каким способом я их преодолел. В ответ же хотелось бы получить комментарии знающих людей относительно корректности моих решений.

                    Как работает DbUnit

                    Подпункт предназначен для тех, кто не знаком с методикой тестирования с использованием PHPUnit и/или DbUnit. Кому не интересно, смело можно переходить к следующему.

                    Далее по тексту:
                    тестовый класс — класс, содержащий код модульных тестов, наследник любой из реализаций PHPUnit::TestCase;
                    тестируемый класс — класс, который необходимо протестировать.
                    Так как подпункт для начинающих, то для начала будет рассмотрена процедура модульного тестирования обычных классов PHP, а потом описаны отличия при тестировании кода, взаимодействующего с БД.

                    Тестирование обычных классов PHP

                    Чтобы протестировать класс, написанный на PHP, с использованием фреймворка PHPUnit, необходимо создать тестовый класс, расширяющий базовый класс PHPUnit_Framework_TestCase. Затем создать в этом классе публичные методы, начинающиеся со слова test (если создать метод, который будет называться по-другому, он не будет автоматически вызван при прогоне тестов), и поместить в них код, выполняющий действия с объектами тестируемого класса и проверяющий результат. На этом можно закончить и скормить полученный класс phpunit, который, в свою очередь, последовательно вызовет все тестовые методы и любезно предоставит отчет об их работе. Однако в большинстве случаев в каждом из тестовых методов будет повторяющийся код, подготавливающий систему для работы с тестируемым объектом. Для того, чтобы избежать дублирования кода, в классе PHPUnit_Framework_TestCase созданы защищенные методы setUp и tearDown, имеющие пустую реализацию. Эти методы вызываются перед и после запуска очередного тестового метода соответственно и служат для подготовки системы к выполнению тестовых действий и очистки ее после завершения каждого теста. В тестовом классе, расширяющем PHPUnit_Framework_TestCase, можно переопределить эти методы и поместить повторяющийся ранее в каждом тестовом методе код в них. В результате последовательность вызова методов при прогонке тестов будет следующая:
                    setUp()       {/* Установили систему в нужное состояние */}
                    testMethod1() {/* протестировали метод 1 класса */}
                    tearDown()    {/* Очистили систему */}
                    setUp()       {/* Установили систему в нужное состояние */}
                    testMethod2() {/* протестировали метод 2 класса */}
                    tearDown()    {/* Очистили систему */}
                    …
                    setUp()       {/* Установили систему в нужное состояние */}
                    testMethodN() {/* протестировали метод N класса */}
                    tearDown()    {/* Очистили систему */}

                    Тестирование кода PHP, взаимодействующего с БД

                    Процесс написания тестов для кода, взаимодействующего с БД, практически не отличается от процедуры тестирования обычных классов PHP. Сначала необходимо создать тестовый класс, наследующий PHPUnit_Extensions_Database_TestCase (класс PHPUnit_Extensions_Database_TestCase сам при этом наследует PHPUnit_Framework_TestCase), который будет содержать тесты для методов тестируемого класса. Затем создать тестовые методы, начинающиеся с префикса test, а потом скормить этот код phpunit с указанием имени тестового класса. Отличия заключаются лишь в том, что в тестовом классе обязательно необходимо реализовать два публичных метода — getConnection() и getDataSet(). Первый метод необходим для того, чтобы научить DbUnit работать с БД (придется использовать PDO), а второй для того, чтобы сообщить фреймворку, в какое состояние переводить базу данных перед выполнением очередного теста. Под DataSet в терминологии DbUnit понимается набор из одной или более таблиц.

                    Как говорилось выше, перед выполнением очередного теста (представленного методом в тестовом классе), PHPUnit вызывает специальный метод setUp(), чтобы сэмулировать среду выполнения для объекта тестируемого класса. В случае DbUnit реализация по умолчанию метода setUp() уже не пустая. Если говорить в общих чертах, то внутри метода setUp() будет создан некий объект databaseTester, который, используя определенный нами метод getConnection(), переведет базу в состояние, представленное набором таблиц (DataSet`ом), получаемым при вызове метода getDataSet(). Если вы были внимательны, то реализация метода getDataSet() также должна предоставляться тестовым классом, т.е. нами. В результате получим похожую последовательность вызовов
                    setUp()       {/* Установили БД в соответствии с данными, получаемыми от
                    метода getDataSet() */}
                    testMethod1() {/* протестировали метод 1 класса */}
                    tearDown()    {/* Очистили систему */}
                    setUp()       {/* Установили БД в соответствии с данными, получаемыми от
                    метода getDataSet() */}
                    testMethod2() {/* протестировали метод 2 класса */}
                    tearDown()    {/* Очистили систему */}
                    …
                    setUp()       {/* Установили БД в соответствии с данными, получаемыми от
                    метода getDataSet() */}
                    testMethodN() {/* протестировали метод N класса */}
                    tearDown()    {/* Очистили систему */}

                    Маленькие неприятности

                    Оперативная обстановка: База данных, используемая в проекте, имеет несколько десятков таблиц, движок MySQL InnoDB. Механизм внешних ключей активно используется с целью поддержания согласованности данных на уровне самой БД.

                    1. Инициализация базы

                    Первая неприятность, которая начала омрачать мне процесс тестирования — инициализация базы данных созданными мной наборами таблиц.

                    DbUnit позволяет создавать DataSet`ы, получая данные из различных источников:
                    Flat Xml — такой простенький способ описание состояния БД в xml-файле, рассчитанный преимущественно на ручное формирование файла.
                    Xml — полноценный формат задания состояния, намного больше букаф, но и более широкие возможности (можно задавать null-значения, более точно описывать структуру БД и пр.).
                    MySQL Xml — разновидность предыдущего формата, любезно предоставленная разработчиками DbUnit, позволяющая создавать объект DataSet на основании экспорта данных БД утилитой mysqldump.
                    Создание объекта DataSet по текущему состоянию БД.

                    Каждый из вышеперечисленных способов создания наборов таблиц реализуется отдельным методом класса PHPUnit_Extensions_Database_TestCase.

                    Я избрал себе в помощники mysqldump и ринулся в атаку: сформировал нужное состояние базы, выгрузил его в xml и в реализации getDataSet() написал что-то вроде:
                    public function getDataSet() {
                    return $this->createMySQLXMLDataSet('db_init.xml');  //имя файла, полученного mysqldump.
                    }


                    … и решил прогнать первый тест. Однако, тут же получил исключение, в котором недвусмысленно говорилось о том, что база данных не может быть приведена в заданное состояние из-за наличия в ней ограничений по внешним ключам.

                    Несколько минут копания в исходниках DbUnit показали, что в методе PHPUnit_Extensions_Database_TestCase::setUp() установка базы в состояние в соответствии с указанным мной DataSet`ом, осуществляется при помощи операции PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT. Операция CLEAN_INSERT в свою очередь представляет собой порождаемую фабрикой макрокоманду, включающую в себя две операции: PHPUnit_Extensions_Database_Operation_Factory::TRUNCATE и PHPUnit_Extensions_Database_Operation_Factory::INSERT. Очевидно, что тут все стало на свои места — не возможно сделать TRUNCATE для базы, у которой имеются активные ограничения по внешним ключам FOREIGN KEY.

                    Нужно решать. Пути два — либо временно отключить FOREIGN KEY во время тестирования (темный путь), либо использовать новую команду PHPUnit_Extensions_Database_Operation_Factory::DELETE_ALL, обнаруженную во время курения исходников DbUnit (светлый, но более длинный путь). Через минуту темная сторона во мне пересилила, и я решил пойти более простым путем — отключить ограничения целостности по внешним ключам во время создания подключения. Благо код создания все равно был написан мной в реализации метода getConnection().

                    Типовая реализация getConnection() выглядит примерно так:
                    public function getConnection() {
                    if (is_null($this->m_oConn)) {
                    $oPdo = new PDO('mysql:dbname=db1;host=localhost', 'root', 'qwerty');
                    $this->m_oConn = $this->createDefaultDBConnection($oPdo, 'db1');
                    }

                    return $this->m_oConn;
                    }

                    $m_oConn — это переменная-член тестового класса, которая представляет собой некоторую обертку вокруг PDO. А если быть точным, то это экземпляр класса PHPUnit_Extensions_Database_DB_DefaultDatabaseConnection. Добавив сразу после создания объекта PDO строку $oPdo->exec('SET foreign_key_checks = 0') я на какое-то время решил проблему с инициализацией.

                    Собственно, как и следовало ожидать, через некоторое время я напоролся на грабли с несогласованностью данных в базе и пришлось возвращаться на светлый путь, а именно — отказаться от отключения внешних ключей и заменить TRUNCATE на DELETE_ALL.

                </div>
                <div class="footer">
                    <div class="footer-item__wrapper">
                        <div class="footer__item">
                            <div>
                            <span class="footer-item__title">надо подумать</span>
                            <a href="#" class="footer-item__text">надо подумать</a>
                            <a href="#" class="footer-item__text">надо подумать</a>
                            <a href="#" class="footer-item__text">надо подумать</a>
                            </div>
                        </div>
                        <div class="footer__item">
                            <div>
                                <span class="footer-item__title">надо подумать</span>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                            </div>
                        </div>

                        <div class="footer__item">
                            <img src="assets/img/logo.png" alt="" class="footer-item--img__wrapper">
                        </div>
                        <div class="footer__item">
                            <div>
                                <span class="footer-item__title">надо подумать</span>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                            </div>
                        </div>
                        <div class="footer__item">
                            <div>
                                <span class="footer-item__title">надо подумать</span>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                                <a href="#" class="footer-item__text">надо подумать</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

</div>

<script src="assets/js/functions.js"></script>

</body>
</html>